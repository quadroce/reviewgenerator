<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Recensione di un film</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        h1, h2 {
            margin-bottom: 10px;
        }

        .recensione {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 20px;
        }

        .film-details {
            margin-bottom: 10px;
        }

        .film-details b {
            font-weight: bold;
        }

        .film-poster {
            max-width: 200px;
        }

        .recensione-chatgpt {
            margin-top: 20px;
        }

        .elenco-film {
            margin-top: 20px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Funzione per generare il tag HTML dell'immagine del poster
        function generaTagImmaginePoster(posterURL) {
            return '<img src="' + posterURL + '" alt="Poster" class="film-poster">';
        }

        // Elenco dei film recensiti
        var elencoFilmRecensiti = [];

        // Funzione per aggiornare l'elenco dei film recensiti nell'HTML
        function aggiornaElencoFilmRecensiti() {
            var elencoFilmRecensitiDiv = document.getElementById("elenco-film-recensiti");
            elencoFilmRecensitiDiv.innerHTML = "";

            for (var i = 0; i < elencoFilmRecensiti.length; i++) {
                var film = elencoFilmRecensiti[i];

                var filmDiv = document.createElement("div");
                filmDiv.innerHTML = "<b>Titolo:</b> " + film.Title + ", <b>Genere:</b> " + film.Genre;
                elencoFilmRecensitiDiv.appendChild(filmDiv);
            }
        }

        // Funzione per generare una recensione casuale
        async function generaRecensioneCasuale() {
            try {
                // Ottieni una descrizione casuale dal sito "What's on Netflix"
                const response = await axios.get('https://www.whats-on-netflix.com/random-netflix-movie-and-series-description-generator/');
                const parser = new DOMParser();
                const htmlDoc = parser.parseFromString(response.data, 'text/html');
                const descriptionElement = htmlDoc.querySelector('.desc');

                // Ottieni la descrizione del film
                const descrizioneFilm = descriptionElement.textContent.trim();

                // Ottieni il film dall'OMDB API utilizzando la descrizione
                const omdbResponse = await axios.get('https://www.omdbapi.com/', {
                    params: {
                        s: descrizioneFilm,
                        type: 'movie',
                        apiKey: '8a6b6167' // Sostituisci con la tua chiave API OMDB
                    }
                });

                const filmCasuale = omdbResponse.data.Search?.find(film => film.Type === 'movie');

                // Controlla se il film Ã¨ stato trovato
                if (!filmCasuale) {
                    // Cerca un altro film
                    return generaRecensioneCasuale();
                }

                // Ottieni i dettagli completi del film utilizzando l'ID IMDB
                const idIMDB = filmCasuale.imdbID;
                const filmCompletoResponse = await axios.get('https://www.omdbapi.com/', {
                    params: {
                        i: idIMDB,
                        apiKey: '8a6b6167' // Sostituisci con la tua chiave API OMDB
                    }
                });

                const filmCompleto = filmCompletoResponse.data;

                // Genera una recensione casuale
                var recensione = '<div class="recensione">';
                recensione += '<div class="film-details"><b>Titolo:</b> ' + filmCompleto.Title + '</div>';
                recensione += '<div class="film-details"><b>Genere:</b> ' + filmCompleto.Genre + '</div>';
                recensione += '<div class="film-details"><b>Regista:</b> ' + filmCompleto.Director + '</div>';
                recensione += '<div class="film-details"><b>Valutazione:</b> ' + filmCompleto.imdbRating + '</div>';
                recensione += '<div class="film-details"><b>Descrizione:</b> ' + filmCompleto.Plot + '</div>';
                recensione += '<div class="film-details"><b>Poster:</b> ' + generaTagImmaginePoster(filmCompleto.Poster) + '</div>';
                recensione += '</div>';

                // Aggiungi il film all'elenco dei film recensiti
                elencoFilmRecensiti.push(filmCompleto);
                aggiornaElencoFilmRecensiti();

                return recensione;
            } catch (error) {
                console.error("Errore durante la generazione della recensione casuale:", error);
                return null;
            }
        }

        // Funzione per generare una recensione con ChatGPT
        async function generaRecensioneChatGPT() {
            try {
                // Genera una recensione casuale
                const recensioneCasuale = await generaRecensioneCasuale();

                if (recensioneCasuale) {
                    // Recupera i dettagli del film dalla recensione casuale
                    const titoloFilm = recensioneCasuale.match(/<b>Titolo:<\/b> ([^<]+)/)[1];
                    const genereFilm = recensioneCasuale.match(/<b>Genere:<\/b> ([^<]+)/)[1];

                    // Esegui una richiesta HTTP per ottenere la recensione generata da ChatGPT
                    const response = await axios.post('https://api.openai.com/v1/engines/davinci-codex/completions', {
                        prompt: "Recensione del film '" + titoloFilm + "' nel genere '" + genereFilm + "':",
                        max_tokens: 100
                    }, {
                        headers: {
                            'Authorization': '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', // Sostituisci con la tua chiave API di OpenAI
                            'Content-Type': 'application/json'
                        }
                    });

                    const completions = response.data.choices;
                    if (completions.length > 0) {
                        var recensioneChatGPT = completions[0].text;

                        // Sostituisci i caratteri speciali HTML nella recensione generata
                        recensioneChatGPT = recensioneChatGPT.replace(/&/g, '&amp;');
                        recensioneChatGPT = recensioneChatGPT.replace(/</g, '&lt;');
                        recensioneChatGPT = recensioneChatGPT.replace(/>/g, '&gt;');

                        // Visualizza la recensione generata da ChatGPT nell'HTML
                        var recensioneChatGPTDiv = document.getElementById("recensione-chatgpt");
                        recensioneChatGPTDiv.innerHTML = recensioneChatGPT;
                    }
                }
            } catch (error) {
                console.error("Errore durante la generazione della recensione con ChatGPT:", error);
            }
        }
    </script>
</head>
<body>
    <h1>Recensione di un film</h1>
    <div class="elenco-film" id="elenco-film-recensiti"></div>
    <h2>Genera recensione con ChatGPT</h2>
    <button onclick="generaRecensioneChatGPT()">Genera recensione con ChatGPT</button>
    <div id="recensione-chatgpt"></div>
</body>
</html>
