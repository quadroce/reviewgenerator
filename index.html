<!DOCTYPE html>
<html>
<head>
    <style>
        .recensione {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 20px;
        }

        .film-details {
            margin-bottom: 10px;
        }

        .film-details b {
            margin-right: 5px;
        }

        .film-details img {
            max-width: 200px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h2>Genera recensione casuale con ChatGPT</h2>
    <div id="recensione-chatgpt"></div>
    <h3>Elenco dei film recensiti:</h3>
    <div id="elenco-film-recensiti"></div>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        // Funzione per generare una tag di immagine per il poster
        function generaTagImmaginePoster(url) {
            return "<img src='" + url + "' alt='Poster'>";
        }

        // Funzione per generare una recensione con ChatGPT
        async function generaRecensioneChatGPT(titoloFilm, genereFilm) {
            try {
                // Genera la recensione utilizzando l'API di ChatGPT
                const response = await axios.post('https://api.openai.com/v1/engines/davinci-codex/completions', {
                    prompt: "Recensione del film " + titoloFilm + " di genere " + genereFilm + ":\n\nRecensione:",
                    max_tokens: 100,
                    temperature: 0.7,
                    n: 1,
                    stop: "\n"
                }, {
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': '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' // Sostituisci con la tua chiave API OpenAI
                    }
                });

                const completions = response.data.choices;
                const recensioneChatGPT = completions[0].text.trim();

                // Aggiungi la recensione generata all'HTML
                var recensioneChatGPTDiv = document.getElementById("recensione-chatgpt");
                recensioneChatGPTDiv.innerHTML = "<h3>Recensione generata con ChatGPT:</h3>" + recensioneChatGPT;
            } catch (error) {
                console.error("Errore durante la richiesta:", error.message);
            }
        }

        var elencoFilmRecensiti = [];

        // Funzione per aggiornare l'elenco dei film recensiti nell'HTML
        function aggiornaElencoFilmRecensiti() {
            var elencoFilmRecensitiDiv = document.getElementById("elenco-film-recensiti");
            elencoFilmRecensitiDiv.innerHTML = "";

            elencoFilmRecensiti.forEach(function(film) {
                var filmDetails = document.createElement("div");
                filmDetails.className = "film-details";
                filmDetails.innerHTML = "<b>Titolo:</b> " + film.Title + "<br>" +
                                        "<b>Genere:</b> " + film.Genre + "<br>" +
                                        "<b>Regista:</b> " + film.Director + "<br>" +
                                        "<b>Valutazione:</b> " + film.imdbRating + "<br>" +
                                        "<b>Descrizione:</b> " + film.Plot + "<br>" +
                                        "<b>Poster:</b> " + generaTagImmaginePoster(film.Poster);

                elencoFilmRecensitiDiv.appendChild(filmDetails);
            });
        }

        // Funzione per generare una recensione casuale
        async function generaRecensioneCasuale() {
            try {
                // Ottieni un film casuale dall'OMDB API
                const omdbResponse = await axios.get('https://www.omdbapi.com/', {
                    params: {
                        type: 'movie',
                        apiKey: '8a6b6167' // Sostituisci con la tua chiave API OMDB
                    }
                });

                const filmCasuale = omdbResponse.data;

                // Controlla se il film ha un'immagine e pu√≤ essere recensito
                if (!filmCasuale.Poster || filmCasuale.Response === "False") {
                    // Cerca un altro film
                    return generaRecensioneCasuale();
                }

                // Genera una recensione casuale
                var recensione = "<div class='recensione'>";
                recensione += "<div class='film-details'><b>Titolo:</b> " + filmCasuale.Title + "</div>";
                recensione += "<div class='film-details'><b>Genere:</b> " + filmCasuale.Genre + "</div>";
                recensione += "<div class='film-details'><b>Regista:</b> " + filmCasuale.Director + "</div>";
                recensione += "<div class='film-details'><b>Valutazione:</b> " + filmCasuale.imdbRating + "</div>";
                recensione += "<div class='film-details'><b>Descrizione:</b> " + filmCasuale.Plot + "</div>";
                recensione += "<div class='film-details'><b>Poster:</b> " + generaTagImmaginePoster(filmCasuale.Poster) + "</div>";
                recensione += "</div>";

                // Aggiungi il film all'elenco dei film recensiti
                elencoFilmRecensiti.push(filmCasuale);
                aggiornaElencoFilmRecensiti();

                // Genera la recensione con ChatGPT
                generaRecensioneChatGPT(filmCasuale.Title, filmCasuale.Genre);

                return recensione;
            } catch (error) {
                console.error("Errore durante la richiesta:", error.message);
                return null;
            }
        }

        // Genera una recensione casuale all'avvio
        generaRecensioneCasuale();
    </script>
</body>
</html>
