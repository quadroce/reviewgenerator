<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Page Title</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Variabile per memorizzare l'elenco dei film recensiti
        var elencoFilmRecensiti = [];

        // Funzione per generare il tag HTML dell'immagine del poster
        function generaTagImmaginePoster(posterURL) {
            return '<img src="' + posterURL + '" alt="Poster">';
        }

        // Funzione per generare una recensione casuale
        async function generaRecensioneCasuale() {
            try {
                // ID del film casuale da recuperare dall'OMDB API
                const filmID = generaFilmIDCasuale();

                // Ottieni il film dall'OMDB API utilizzando l'ID
                const response = await axios.get('https://www.omdbapi.com/', {
                    params: {
                        i: filmID,
                        apikey: '8a6b6167' // Sostituisci con la tua chiave API OMDB
                    }
                });

                const filmCasuale = response.data;

                // Controlla se il film ha un'immagine e pu√≤ essere recensito
                if (!filmCasuale.Poster || filmCasuale.Response === "False") {
                    // Cerca un altro film
                    return generaRecensioneCasuale();
                }

                // Genera una recensione casuale
                var recensione = "Titolo: " + filmCasuale.Title + "<br>";
                recensione += "Genere: " + filmCasuale.Genre + "<br>";
                recensione += "Regista: " + filmCasuale.Director + "<br>";
                recensione += "Valutazione: " + filmCasuale.imdbRating + "<br>";
                recensione += "Descrizione: " + filmCasuale.Plot + "<br>";
                recensione += "Poster: " + generaTagImmaginePoster(filmCasuale.Poster) + "<br>";

                // Aggiungi il film all'elenco dei film recensiti
                elencoFilmRecensiti.push(filmCasuale);

                // Aggiorna l'elenco dei film recensiti nell'HTML
                aggiornaElencoFilmRecensiti();

                return recensione;
            } catch (error) {
                console.error("Errore durante la richiesta all'OMDB API:", error.message);
                return null;
            }
        }

        // Funzione per generare un filmID casuale
        function generaFilmIDCasuale() {
            var filmID = "tt";
            for (var i = 0; i < 7; i++) {
                filmID += Math.floor(Math.random() * 10);
            }
            return filmID;
        }

        // Funzione per ottenere una recensione generata da ChatGPT
        async function generaRecensioneChatGPT() {
            try {
                // Recupera i dettagli del film dal form
                var titoloFilm = document.getElementById("titolo-film").value;
                var genereFilm = document.getElementById("genere-film").value;

                // Esegui una richiesta HTTP per ottenere la recensione generata da ChatGPT
                const response = await axios.post('https://api.openai.com/v1/engines/davinci-codex/completions', {
                    prompt: "Recensione del film '" + titoloFilm + "' nel genere '" + genereFilm + "':",
                    max_tokens: 100
                }, {
                    headers: {
                        'Authorization': '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', // Sostituisci con la tua chiave API di OpenAI
                        'Content-Type': 'application/json'
                    }
                });

                const completions = response.data.choices;
                if (completions.length > 0) {
                    var recensioneChatGPT = completions[0].text.trim();

                    // Aggiungi la recensione di ChatGPT al div con id "recensione-chatgpt"
                    var recensioneChatGPTDiv = document.getElementById("recensione-chatgpt");
                    recensioneChatGPTDiv.innerHTML = recensioneChatGPT;
                }
            } catch (error) {
                console.error("Errore durante la richiesta a ChatGPT:", error.message);
            }
        }

        // Funzione per aggiornare l'elenco dei film recensiti nell'HTML
        function aggiornaElencoFilmRecensiti() {
            // Ottieni il div con id "elenco-film"
            var elencoFilmDiv = document.getElementById("elenco-film");

            // Svuota il div
            elencoFilmDiv.innerHTML = "";

            // Crea una lista non ordinata per gli elementi dell'elenco dei film recensiti
            var elencoFilmUl = document.createElement("ul");

            // Aggiungi la lista al div
            elencoFilmDiv.appendChild(elencoFilmUl);

            // Aggiungi ogni film all'elenco dei film recensiti
            elencoFilmRecensiti.forEach(function(film) {
                var li = document.createElement("li");
                li.innerHTML = film.Title;
                elencoFilmUl.appendChild(li);
            });
        }

        // Aggiorna l'elenco dei film recensiti all'avvio
        aggiornaElencoFilmRecensiti();

        // Genera una recensione casuale all'avvio
        generaRecensioneCasuale()
            .then((recensioneCasuale) => {
                // Aggiungi la recensione casuale al div con id "recensione-casuale"
                var recensioneCasualeDiv = document.getElementById("recensione-casuale");
                recensioneCasualeDiv.innerHTML = recensioneCasuale;
            })
            .catch((error) => {
                console.error("Errore durante la generazione della recensione casuale:", error);
            });

        // Genera una recensione casuale ogni minuto
        setInterval(function() {
            generaRecensioneCasuale()
                .then((recensioneCasuale) => {
                    // Aggiungi la recensione casuale al div con id "recensione-casuale"
                    var recensioneCasualeDiv = document.getElementById("recensione-casuale");
                    recensioneCasualeDiv.innerHTML = recensioneCasuale;
                })
                .catch((error) => {
                    console.error("Errore durante la generazione della recensione casuale:", error);
                });
        }, 10000);

    </script>
</head>
<body>
    <h1>Recensione di un film 1</h1>
    
    <h2>Recensione casuale</h2>
    <div id="recensione-casuale"></div>
    
    <h2>Genera recensione con ChatGPT</h2>
    <form onsubmit="event.preventDefault(); generaRecensioneChatGPT();">
        <label for="titolo-film">Titolo del film:</label>
        <input type="text" id="titolo-film" name="titolo-film" required>
        <br>
        <label for="genere-film">Genere del film:</label>
        <input type="text" id="genere-film" name="genere-film" required>
        <br>
        <button type="submit">Genera recensione</button>
    </form>
    
    <div id="recensione-chatgpt"></div>

    <h2>Elenco dei film recensiti</h2>
    <div id="elenco-film"></div>
</body>
</html>
